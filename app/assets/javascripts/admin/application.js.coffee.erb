//= require jquery
//= require jquery_ujs
//= require jquery.ui.sortable
//= require jquery.ui.effect.all
//= require underscore
//= require twitter/bootstrap
//= require select2/select2
//= require select2/select2_locale_ru
//= require bootstrap3-wysihtml5/lib/js/wysihtml5-0.3.0
//= require bootstrap3-wysihtml5/src/bootstrap3-wysihtml5
//= require bootstrap3-wysihtml5/src/locales/bootstrap-wysihtml5.ru-RU
//= require jquery.scrollTo/jquery.scrollTo
//= require tabs_memory
//= require ./search-box
//= require ./transliterate
//= require ./destroy_helper
//= require ./sort
//= require ./products
//= require ./category

$ ->
  $(document).ajaxComplete (event, request) ->
    try
      data = JSON.parse request.responseText
      if data.flash
        $('#content').prepend(data.flash)
        $('.flash-message').delay(5000).slideUp()
    catch e

  $('.flash-message').delay(5000).slideUp()

  $('ul.nav.bs-sidenav > li > a').click (e) ->
    if $(this).next('ul.nav').length
      $(this).next('ul.nav').slideToggle()
      e.preventDefault()

  $('select').select2(allowClear: true)

  $.extend(
    true
    $.fn.wysihtml5.defaultOptions
    parserRules:
      tags:
        h1: { 'remove': 1 }
        p: {}
  )
  $.extend(
    true
    $.fn.wysihtml5.locale["ru-RU"]
    font_styles:
      h4: 'Заголовок 4'
      h5: 'Заголовок 5'
      h6: 'Заголовок 6'
  )

  $('.wysihtml5').wysihtml5
    locale: 'ru-RU'
    html: true
    image: false
    stylesheets: "<%= asset_path('bootstrap3-wysihtml5/lib/css/bootstrap3-wysiwyg5-color') %>"

  $('a.top').click (e) ->
    $.scrollTo 'body', 500
    e.preventDefault()

  $('.transliterate').click (e) ->
    val = transliterate($($(this).data('source')).val())
    val = val.replace /^\s+|\s+$/g, ''
    val = val.replace /\s+/g, '-'
    val = val.replace /\-+/g, '-'
    val = val.replace /[^A-z0-9\-]/g, ''
    $($(this).data('target')).val val.toLowerCase()
    e.preventDefault()
